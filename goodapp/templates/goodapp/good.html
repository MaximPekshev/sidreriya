{% extends 'baseapp/index.html' %}

{% load static %}

{% block meta_description %}{% if good.meta_description %}{{ good.meta_description }}{% else %} {{good.description|slice:"230" }}{% endif %}. Гастробар Сидрерия.{% endblock %}

{% block title %}{% if good.meta_name %}{{ good.meta_name }}{% else %}{{ good.name }}{% if good.name_en %} / {{ good.name_en }}{% endif %}{% endif %}. Гастробар Сидрерия.{% endblock %}

{% block social %}
{% endblock %}

{% block custom_lib %}
<script src="https://unpkg.com/vue@3.0.1/dist/vue.global.prod.js"></script>
<script src="https://unpkg.com/axios@1.0.0/dist/axios.min.js"></script>
<script src="https://unpkg.com/naive-ui@2.40.4/dist/index.prod.js"></script>
{% endblock %}

{% block content %}
<div class="main-container left-sidebar" id="goodApp">
	<n-config-provider :theme-overrides="themeOverrides">
		<div class="container">
			<nav class="woocommerce-breadcrumb breadcrumbs">
				<a href="{% url 'baseapp:index' %}">На главную</a>
				<a href="{% url 'show_catalog' %}?Категория={{ good.category }}">{{ good.category }}</a>
				<a href="{% url 'show_good'  slug=good.slug %}">{{ good.name }} {% if good.name_en %} / {{ good.name_en }}{% endif %}</a>
			</nav>
			<div class="row">
				<div class="col-sm-12 col-md-12 main-content">
					<div class="single-product">
						<div class="row">
							<div class="col-sm-12 col-md-5">
								<div class="images kt-images">
									<div class="kt-main-image">
										{% if good.main_image.images %}
										<a class="zoom" href="{{ good.main_image.images.url }}"><img src="{{ good.main_image.images.url }}" alt="{{ good.name }} {% if good.name_en %} / {{ good.name_en }}{% endif %}"></a>
										{% else %}
										<a class="zoom" href="{% static 'images/products/no-photo.png' %}">
											<img src="{% static 'images/products/no-photo.png' %}" alt=""/>
										</a>
										{% endif %}
									</div>
								</div>
							</div>
							<div class="col-sm-12 col-md-7">
								<div class="summary">
									<h1 class="product_title entry-title">{{ good.name }} {% if good.name_en %} / {{ good.name_en }} {% endif %}</h1>
									{% if good.price %}

									<span class="price">&#8381 {{ good.price }} / </span><span class="price discount-price"> &#8381 {{ good.discount_price }} *</span>
									{% else %}
									<span class="price">&#8381 0</span>
									{% endif %}
									<p class="stock out-of-stock"><label>в Сидрерии:</label>
										{% if good.quantity > 0 %}
										<i class="fa fa-check"></i> 
										в наличии
										{% else %}
										<i class="fa fa-times" style="color: orange;"></i> 
										{% if good.is_cidre or good.is_vine %} все выпили {% else %} закончилось {% endif %}
										{% endif %}
									</p>
									<div class="short-descript">
										<p align="justify">{{ good.description|linebreaksbr }}</p>
									</div>
									{% if good.is_cidre %}
									<div class="variation_form_section">
										<h2 class="product_title entry-title" style="font-size: 100%; font-weight: 600">Гастрономия</h2>
										<div class="short-descript">
										<p align="justify">{{ good.gastronomy|linebreaksbr }}</p>
										</div>
									</div>
									{% endif %}
									{% if good.is_cidre %}
									<div class="variation_form_section">
										<h2 class="product_title entry-title" style="font-size: 100%; font-weight: 600">Характеристики</h2>
										<div class="row">
											<div class="col-sm-6 col-md-6">
												<div>
													<label>Производитель:</label>
													<a href="{% if good.manufacturer %} {% url 'show_catalog' %}?Производитель={{ good.manufacturer.name }} {% endif %}">{% if good.manufacturer %}{{ good.manufacturer }}{% endif %}</a>
												</div>
												<div>
													<label>Что внутри?:</label>
													<a href="{% url 'show_catalog' %}?{{ inside.property }}={{ inside.value }}">{% if inside %}{{ inside.value }}{% endif %}</a>
												</div>
												<div>
													<label>Регион:</label>
													<a href="{% url 'show_catalog' %}?{{ country.property }}={{ country.value }}">{% if country %}{{ country.value }}{% endif %}</a>
												</div>
												<div>
													<label>Крепость:</label>
													{% comment %} <a href="{% url 'show_catalog' %}?{{ strength.property }}={{ strength.value }}">{% if strength %}{{ strength.value }} %{% endif %}</a> {% endcomment %}
													{% if strength %}{{ strength.value }} %{% endif %}
												</div>
												<div>
													<label>Сладость:</label>
													<a href="{% url 'show_catalog' %}?{{ sugar.property }}={{ sugar.value }}">{% if sugar %}{{ sugar.value }}{% endif %}</a>
												</div>

											</div>
											<div class="col-sm-6 col-md-6">
												<div>
													<label>Объем бутылочки:</label>
													<a href="{% url 'show_catalog' %}?{{ volume.property }}={{ volume.value }}">{% if volume %}{{ volume.value }} L{% endif %}</a>
												</div>
												<div>
													<label>Пузырьки:</label>
													<a href="{% url 'show_catalog' %}?{{ gas.property }}={{ gas.value }}">{% if gas %}{{ gas.value }}{% endif %}</a>
												</div>
												<div>
													<label>Пастеризация:</label>
													<a href="{% url 'show_catalog' %}?{{ pasteuriz.property }}={{ pasteuriz.value }}">{% if pasteuriz %}{{ pasteuriz.value }}{% endif %}</a>
												</div>
												<div>
													<label>Фильрация:</label>
													<a href="{% url 'show_catalog' %}?{{ filtration.property }}={{ filtration.value }}">{% if filtration %}{{ filtration.value }}{% endif %}</a>
												</div>
											</div>
										</div>
									</div>
									{% elif good.is_vine %}
									<div class="variation_form_section">
										<h2 class="product_title entry-title" style="font-size: 100%; font-weight: 600">Характеристики</h2>
										<div class="row">
											<div class="col-sm-6 col-md-6">
												<div>
													<label>Тип:</label>
													<a href="{% url 'show_catalog' %}?{{ type.property }}={{ type.value }}">{% if type %}{{ type.value }}{% endif %}</a>
													, <a href="{% url 'show_catalog' %}?{{ sugar.property }}={{ sugar.value }}">{% if sugar %}{{ sugar.value }}{% endif %}</a>
												</div>
												<div>
													<label>Регион:</label>
													<a href="{% url 'show_catalog' %}?{{ country.property }}={{ country.value }}">{% if country %}{{ country.value }}{% endif %}</a>
												</div>
												<div>
													<label>Виноград:</label>
													{% for item in grapes %}
													<a href="{% url 'show_catalog' %}?{{ item.property }}={{ item.value }}">{% if item %}{{ item.value }}{% endif %}</a>
													{% endfor %}
												</div>
												<div>
													<label>Бренд:</label>
													<a href="{% url 'show_catalog' %}?{{ brand.property }}={{ brand.value }}">{% if brand %}{{ brand.value }}{% endif %}</a>
												</div>
											</div>
											<div class="col-sm-6 col-md-6">
												<div>
													<label>Производитель:</label>
													<a href="{% if good.manufacturer %} {% url 'show_catalog' %}?Производитель={{ good.manufacturer.name }} {% endif %}">{% if good.manufacturer %}{{ good.manufacturer }}{% endif %}</a>
												</div>
												<div>
													<label>Крепость:</label>
													{% comment %} <a href="{% url 'show_catalog' %}?{{ strength.property }}={{ strength.value }}">{% if strength %}{{ strength.value }} %{% endif %}</a> {% endcomment %}
													{% if strength %}{{ strength.value }} %{% endif %}
												</div>
												<div>
													<label>Объем:</label>
													<a href="{% url 'show_catalog' %}?{{ volume.property }}={{ volume.value }}">{% if volume %}{{ volume.value }}{% endif %}</a>
												</div>
											</div>
										</div>
									</div>
									{% endif %}
									{% if good.is_cider %}
									<div class="quantity"></div>
									<div class="variation_form_section">
										<h2 class="product_title entry-title" style="font-size: 100%; font-weight: 600">Гастрономия</h2>
										<div class="short-descript">
										<p align="justify">{{ good.gastronomy|linebreaksbr }}</p>
										</div>
									</div>
									{% endif %}
									<div class="quantity"></div>
									<div class="wishlist-item">
											<n-flex v-cloak align="center" reverse>
												<a 
													href="#" 
													@click="addDelGoodToWishlist($event)"
													class="button wishlist" 
													:class="{ inWishlist: good_object.in_wishlist }"
												>
													<n-spin v-if="good_object.wl_loading == true"></n-spin>
													<i v-else class="fa fa-heart-o"></i>
												</a>
												<button v-if="good_object.ct_loading" disabled>
													<n-spin size="small"></n-spin>
												</button>
												<button v-else @click="addGoodToCart($event)">В корзину</button>
												<n-select 
													v-if="good_object.in_barrel == true"
													style="width:100px;"
													v-model:value="qty" 
													size="large" 
													:options="valueOptions"
												></n-select>
												<n-input-number 
													v-else
													style="width:100px;"
													size="large" 
													v-model:value="qty" 
													:validator="validator" 
												></n-input-number>
											</n-flex>
									</div>
								</div>
							</div>     
						</div> 
						{% if good.is_vine %}
						<div class="row">
							<div class="col-12 heading-section style2 text-center margin-top-30 margin-bottom-10 padding-left-10" >
								<h3 class="title" style="font-weight: 600;">Дегустация</h3>
							</div>
							<div class="col-sm-12 col-md-6" style="padding: 20px 30px;">
								<div class="variation_form_section">
									<h2 class="product_title entry-title" style="font-size: 100%; font-weight: 600">Цвет</h2>
									<div class="short-descript">
										<p align="justify">{{ good.color|linebreaksbr }}</p>
									</div>
								</div>
							</div>
							<div class="col-sm-12 col-md-6" style="padding: 20px 30px;">
								<div class="variation_form_section">
									<h2 class="product_title entry-title" style="font-size: 100%; font-weight: 600">Аромат</h2>
									<div class="short-descript">
										<p align="justify">{{ good.fragrance|linebreaksbr }}</p>
									</div>
								</div>
							</div>
							<div class="col-sm-12 col-md-6" style="padding: 20px 30px;">
								<div class="variation_form_section">
									<h2 class="product_title entry-title" style="font-size: 100%; font-weight: 600">Вкус</h2>
									<div class="short-descript">
										<p align="justify">{{ good.taste|linebreaksbr }}</p>
									</div>
								</div>
							</div>
							<div class="col-sm-12 col-md-6" style="padding: 20px 30px;">
								<div class="variation_form_section">
									<h2 class="product_title entry-title" style="font-size: 100%; font-weight: 600">Гастрономия</h2>
									<div class="short-descript">
										<p align="justify">{{ good.gastronomy|linebreaksbr }}</p>
									</div>
								</div>
							</div>
						</div>
						{% if good.manufacturer %}
						<div class="row">
							<div class="col-12" style="padding: 20px 30px;">
								<div class="variation_form_section">
									<h2 class="product_title entry-title" style="font-size: 100%; font-weight: 600">О производителе</h2>
									<div class="short-descript">
										<p align="justify">{{ good.manufacturer.description|linebreaksbr }}</p>
									</div>
								</div>
							</div>
						</div>
						{% endif %}   
						{% endif %}
						{% if opv %}
						<div class="row">
							{% if good.is_cidre %}
							<div class="col-sm-12 col-md-5"></div>
							{% endif %}
							<div class="col-sm-12 {% if good.is_cidre %}col-md-7{% endif %}">
								<div class="product-tabs">
									<ul class="nav-tab">
										<li class="active"><a data-toggle="tab" href="#tab-1">Теги</a></li>
									</ul>
									<div class="tab-container">
										<div id="tab-1" class="tab-panel active">
											<div class="tagcloud">
												{% for item in opv %}
													<a href="{% url 'show_catalog' %}?{{ item.property_name }}={{ item.property_value }}">{{ item.property_value }}</a>
												{% endfor %}
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						{% endif %}
					</div>
					{% if upsell_products %}
					<div class="related products">	
						<div class="heading-section text-center">
							<h3 class="title">Сопутствующие товары</h3>
						</div>
						<ul class="owl-carousel nav-center nav-style-1" data-loop="true" data-nav="true" data-dots="false" data-margin="10" data-responsive='{"0":{"items":"1"},"768":{"items":"2"},"992":{"items":"3"}, "1222":{"items":"4"}}'>
							{% for item in good.upsell_products %}
							<li class="product-item">
								<div class="product-inner">
									<div class="thumb has-second-image">
										<a href="{% url 'show_good' slug=item.slug %}">
											{% if item.image %}
												<img src="{{ item.main_image.images.url }}" alt="">
												{% else %}
												<img src="{% static 'images/products/no-photo.png' %}" alt="{{ item.name }}{% if item.name_en %} / {{ item.name_en }} {% endif %}">
											{% endif %}
										</a>
										<form id="{{ item.slug }}addtocart" action="{% url 'cart_add_item' slug=item.good.slug %}" method="POST">
												{% csrf_token %}
												<input type="hidden" name="quantity" value="1">
										</form>
										<div class="group-button">
											{% if item.quantity >= 1 %}
											{% if item.in_barrel %}
											{% if item in barrels %}
												<button form="{{ item.slug }}addtocart" type="submit" class="">В корзину</button>
											{% endif %}
											{% else %}
											<button form="{{ item.slug }}addtocart" type="submit" class="">В корзину</button>
											{% endif %}
											{% endif %}
										</div>
										<div class="flash">
											{% if not item.quantity %}
											<span class="sale">Все выпили</span>
											{% endif %}
											{% if item.in_barrel %}
											<span class="new">Розлив</span>
											{% endif %}
										</div>	
									</div>
									<div class="info">
										<h3 class="product-name short"><a href="{% url 'show_good' slug=item.slug %}">{{ item.name }}{% if item.name_en %} / {{ item.name_en }} {% endif %}</a></h3>
										{% if item.price %}
											{% if item.old_price %}
												&#8381 {{ item.old_price }}</del></span>
											{% else %}
											<span class="price">&#8381 {{ item.price }} / &#8381 * {{ item.discount_price }}</span>
											{% endif %}
										{% else %}
											<span class="price">&#8381 0</span>
										{% endif %}
									</div>
								</div>
							</li>
							{% endfor %}

						</ul>
					</div>
					{% endif %}
				</div>
			</div>    
		</div>
	</n-config-provider>
</div>        

<div class="container">
	{% include 'baseapp/widgets/pickup_reminder.html' %}
</div>
{% endblock %}

{% block magnific_popup %}
{% endblock %}

{% block custom_script %}
<script type="text/javascript">
	const GoodApp = {
		data () {
			const { NConfigProvider } = naive
			const themeOverrides = {
				common: {
				  primaryColor: '#444444',
				  primaryColorHover: '#444444',
				},
				Badge: {
				  color: '#eec15b',
				},
			}
			return {
				good_object: {},
				NConfigProvider,
				themeOverrides,
				qty: 1,
				validator: (x) => x > 0,
				valueOptions: [
					{ label: '0.5', value: 0.5 },
					{ label: '1.0', value: 1 },
					{ label: '1.5', value: 1.5 },
					{ label: '2.0', value: 2 },
					{ label: '2.5', value: 2.5 },
					{ label: '3.0', value: 3 },
					{ label: '3.5', value: 3.5 },
					{ label: '4.0', value: 4 },
				]
			}
		},
		delimiters: ["${", "}$"],
		computed: {
			good () {
				return {{ json_good|safe }}
			}
		},
		mounted () {
			this.good_object = this.good
		},
		methods: {
			addGoodToCart (el) {
				el.preventDefault()
				let good = this.good_object
				good.ct_loading = true
				setTimeout(() => {
					axios.defaults.xsrfCookieName = 'csrftoken'
					axios.defaults.xsrfHeaderName = "X-CSRFTOKEN"
					axios({
						method: 'post',
						url: `/api/v1/cart/`,
						data: {
							"price": good.price,
							"good": good.pk,
							"quantity": this.qty
						}
					}).then(response => {
						window.location.reload()
					}).catch(error => {
						console.log(error)
					}).finally(() => {
						good.ct_loading = false
					})
				}, 500)

			},
			addDelGoodToWishlist (el) {
				el.preventDefault()
				this.good_object.wl_loading = true
				setTimeout(() => {
					axios.defaults.xsrfCookieName = 'csrftoken'
					axios.defaults.xsrfHeaderName = "X-CSRFTOKEN"
					if (this.good_object.in_wishlist) {
						axios({
							method: 'delete',
							url: `/api/v1/wishlist/${this.good_object.slug}/`,
						}).then(response => {
							window.location.reload()
						}).catch(error => {
							console.log(error)
						}).finally(() => {
							this.good_object.wl_loading = false
						})
					} else {
						axios({
							method: 'post',
							url: `/api/v1/wishlist/`,
							data: {
								"price": this.good_object.price,
								"good": this.good_object.pk
							}
						}).then(response => {
							window.location.reload()
						}).catch(error => {
							console.log(error)
						}).finally(() => {
							this.good_object.wl_loading = false
						})
					}
				}, 500)
			},
		}
	}
	const app = Vue.createApp(GoodApp)
	app.use(naive)
	app.mount('#goodApp')
</script>

{% endblock %}